/*!
 * jquery.cascader v1.2.0
 * Copyright 2021 .
 * Licensed under the  license
 */
"use strict";!function(n,o){var a=[];n.fn.extend({cascader:function(t){if(1<=this.length){var e=this[0];if(-1===a.indexOf(e))return a.push(e),new s(e,t)}}});var i={crtLevel:0,maxLevel:3,defaultData:[],defaultValue:[],hasSearchLevel:[2,3],success:function(){},getData:function(){},isScroll:!1};function s(t,e){this.id="cascader"+c.getRandom(),this.ele=t,this.option=n.extend({},i,e),this.data=c.getFormatData(this.option.defaultData),this.defaultValue=this.option.defaultValue,this.result=[],this.init()}s.prototype.init=function(){this.setLayout(),this.bindEvent(),this.initDefaultValue()},s.prototype.initDefaultValue=function(){0===this.defaultValue.length?this.getData(0):this.getDataByDefaultValue()},n.extend(s.prototype,{getDataByDefaultValue:function(){var e=this;this.loadDataByDefaultValue(0,{},function(t){e.data=n.extend({},e.data,t),e.initRender()})},loadDataByDefaultValue:function(e,a,i){var t,n,o;this.defaultValue.length>=e&&e<=this.option.maxLevel?(t=this.defaultValue[e-1]||{key:"",value:""},n=e.toString()+t.key+t.value,(o=this.data[n])?(a[n]=o,this.loadDataByDefaultValue(e+1,a,i)):this.option.getData.call(this,{key:t.key,value:t.value},function(t){a[n]=t,this.loadDataByDefaultValue(e+1,a,i)}.bind(this))):i(a)},initRender:function(){var t,a=this;this.defaultValue.forEach(function(t,e){a.option.crtLevel=e;e=a.defaultValue[e-1]||{key:"",value:""},e=a.option.crtLevel.toString()+e.key+e.value;a.setBodyLayout(t),a.setBodyLayoutContentByData(a.data[e],t)}),this.option.crtLevel<this.option.maxLevel&&(this.option.crtLevel++,t=this.defaultValue[index-1]||{key:"",value:""},t=this.option.crtLevel.toString()+t.key+t.value,this.setBodyLayout(),this.setBodyLayoutContentByData(this.data[t],item)),this.result=this.defaultValue}}),n.extend(s.prototype,{getBox:function(){return n("#".concat(this.id))},getBoxShade:function(){return n("#".concat(this.id,"_shade"))},getBoxBtnCancel:function(){return this.getBox().find(".cascader-btns .cascaderCancel")},getBoxBtnOK:function(){return this.getBox().find(".cascader-btns .cascaderOK")},getLastItem:function(){return this.getBox().find(".cascader-body").last().find(".cascader-body-content")}}),n.extend(s.prototype,{setLayout:function(){var t=[];t.push('<div id="'.concat(this.id,'" class="cascader-box">')),t.push('<div class="cascader-btns">'),t.push('<button class="c-btn c-btn-default c-btn-mini cascaderCancel">取消</button>'),t.push('<button class="c-btn c-btn-default c-btn-mini c-btn-primary cascaderOK">确认</button>'),t.push("</div>"),t.push("</div>"),t.push('<div id="'.concat(this.id,'_shade" class="cascader-box-shade"></div>')),n("body").append(t.join(""))},setBodyLayout:function(){var t=0<arguments.length&&arguments[0]!==o?arguments[0]:{key:"",value:""},e=[],a=this.option.crtLevel,i=this.isHasSearchLevel()?this.getBodyLayoutHeader():"",n=this.getBodyLayoutContent();e.push('<div class="cascader-body" data-level="'.concat(a,'" data-key="').concat(t.key,'" data-value="').concat(t.value,'">')),e.push(i),e.push(n),e.push("</div>"),this.clearBodyLayoutByLevel(a),this.getBox().append(e.join(""))},clearBodyLayoutByLevel:function(e){this.getBox().find(".cascader-body").each(function(t){e<=t&&n(this).remove()})},getBodyLayoutHeader:function(){var t=[];return t.push('<div class="cascader-body-header">'),t.push('<input type="text"/>'),t.push("</div>"),t.join("")},getBodyLayoutContent:function(){var t=[],e="cascader-body-content"+(this.isHasSearchLevel()?" v2":"");return t.push('<ul class="'.concat(e,'">')),t.push('<li class="cascader-item-loading"><span>加载中...</span></li>'),t.push("</ul>"),t.join("")},setBodyLayoutContentByData:function(t){var e=1<arguments.length&&arguments[1]!==o?arguments[1]:{key:"",value:""},a=[],i=this.option.crtLevel===this.option.maxLevel?"":" more-icon";t.forEach(function(t){a.push('<li class="cascader-item'.concat(i).concat(t.key===e.key?" active":"",'" data-key="').concat(t.key,'" data-value="').concat(t.value,'"><span>').concat(t.value,"</span></li>"))}),this.getLastItem().html(a.join(""))},isHasSearchLevel:function(){return-1<this.option.hasSearchLevel.indexOf(this.option.crtLevel)}}),n.extend(s.prototype,{getData:function(t){var e=!(1<arguments.length&&arguments[1]!==o)||arguments[1];this.option.crtLevel=t,this.unBindEvent(),e?this.setBodyLayout():this.clearBodyLayoutByLevel(t+1);e=this.getParamsByIndex(t-1),t=this.getDataKey(),t=this.data[t];t?this.getDataCallback(t):this.option.getData.call(this,e,this.getDataCallback.bind(this))},getDataCallback:function(t){var e=this.getDataKey();this.data[e]=t,this.setBodyLayoutContentByData(t),this.bindEvent()},getParamsByIndex:function(t){t=this.getBox().find(".cascader-body").eq(t);return{key:t.data("key")||"",value:t.data("value")||"",content:n.trim(t.next().find(".cascader-body-header input").val()||"")}},getDataKey:function(){var t=this.getParamsByIndex(this.option.crtLevel-1);return this.option.crtLevel.toString()+t.key+t.value+t.content},getResult:function(){var e=[],a=[],i=[];return this.result.forEach(function(t){e.push(t.key),a.push(t.value),i.push(t)}),{keys:e,values:a,data:i}},getKeyByParentPrev:function(t){t=t.prev(".cascader-body");return t.length<=0?"0":(parseInt(t.data("level"))+1).toString()+t.data("key")+t.data("value")},setResult:function(t,e){this.result[t]=e,this.result.length=t+1}}),n.extend(s.prototype,{unBindEvent:function(){this.getBox().off("click")},bindEvent:function(){var a=this,t=null;this.getBox().off("click").on("click",".cascader-item",function(){var t=n(this).closest(".cascader-body"),e=+t.data("level");t.data("key",n(this).data("key")),t.data("value",n(this).data("value"));t=a.getKeyByParentPrev(t);a.setResult(e,a.data[t][n(this).index()]),n(this).addClass("active").siblings().removeClass("active"),a.option.maxLevel===e?(t=a.getResult(),a.option.success.call(a,t.keys,t.values,t.data),a.hide()):a.getData(1+e)}),this.getBox().off("keyup").on("keyup","input",function(){var e=this;clearTimeout(t),t=setTimeout(function(){var t=+n(e).closest(".cascader-body").data("level");a.getData(t,!1)},300)}),n(this.ele).unbind("click").bind("click",function(){a.show()}),this.getBoxShade().unbind("click").bind("click",function(){a.hide()}),this.getBoxBtnCancel().unbind("click").bind("click",function(){a.hide()}),this.getBoxBtnOK().unbind("click").bind("click",function(){var t=a.getResult();a.option.success.call(a,t.keys,t.values,t.data),a.hide()})}}),s.prototype.show=function(){var t=c.getMaxZIndex(),e=this.ele.offsetLeft,a=this.ele.offsetTop+this.ele.offsetHeight+5;this.getBox().css({display:"block",zIndex:t+100,left:e,top:a}),this.getBoxShade().css({display:"block",zIndex:t+99}),this.scrollFixedPosition()},s.prototype.hide=function(){this.getBox().hide(),this.getBoxShade().hide()},s.prototype.scrollFixedPosition=function(){var t=this;this.option.isScroll||(this.option.isScroll=!0,this.getBox().find(".cascader-item.active").each(function(){t.scrollFixedPositionByElement(this)}))},s.prototype.scrollFixedPositionByElement=function(t){var e=1<arguments.length&&arguments[1]!==o&&arguments[1],a=n(t),i=a.index(),t=a[0].scrollHeight,t=t*i-3*t;a.parent().animate({scrollTop:t},e?300:0)};var c={getMaxZIndex:function(){return Math.max.apply(null,n.map(n("body *"),function(t,e){return"static"!=n(t).css("position")?parseInt(n(t).css("z-index"))||1:-1}))},getRandom:function(){return Math.random().toString().slice(2,12)},getFormatData:function(t){var e={};return this.formatData(t,e,0,parent),e},formatData:function(t,e,a,i){0<t.length&&(e[a.toString()+(i.key||"")+(i.value||"")]=t).forEach(function(t){t.children&&c.formatData(t.children,e,a+1,t)})}}}((window,jQuery));