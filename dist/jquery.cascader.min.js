/*!
 * jquery.cascader v1.2.0
 * Copyright 2019 xieqian.
 * Licensed under the MIT license
 */
"use strict";!function(t,s,c){var a=[];s.fn.extend({cascader:function(t){if(1<=this.length){var e=this[0];if(-1===a.indexOf(e))return a.push(e),new n(e,t)}}});var i={crtLevel:0,maxLevel:3,defaultData:[],defaultValue:[],hasSearchLevel:[2,3],success:function(){},getData:function(){},isScroll:!1};function n(t,e){this.id="cascader"+o.getRandom(),this.ele=t,this.option=s.extend({},i,e),this.data=o.getFormatData(this.option.defaultData),this.defaultValue=this.option.defaultValue,this.result=[],this.init()}n.prototype.init=function(){this.setLayout(),this.bindEvent(),this.initDefaultValue()},n.prototype.initDefaultValue=function(){0===this.defaultValue.length?this.getData(0):this.getDataByDefaultValue()},s.extend(n.prototype,{getDataByDefaultValue:function(){var e=this;this.loadDataByDefaultValue(0,{},function(t){e.data=s.extend({},e.data,t),e.initRender()})},loadDataByDefaultValue:function(e,a,i){if(this.defaultValue.length>=e&&e<=this.option.maxLevel){var t=this.defaultValue[e-1]||{key:"",value:""},n=e.toString()+t.key+t.value,o=this.data[n];o?(a[n]=o,this.loadDataByDefaultValue(e+1,a,i)):this.option.getData.call(this,{key:t.key,value:t.value},function(t){a[n]=t,this.loadDataByDefaultValue(e+1,a,i)}.bind(this))}else i(a)},initRender:function(){var n=this;if(this.defaultValue.forEach(function(t,e){n.option.crtLevel=e;var a=n.defaultValue[e-1]||{key:"",value:""},i=n.option.crtLevel.toString()+a.key+a.value;n.setBodyLayout(t),n.setBodyLayoutContentByData(n.data[i],t)}),this.option.crtLevel<this.option.maxLevel){this.option.crtLevel++;var t=this.defaultValue[index-1]||{key:"",value:""},e=this.option.crtLevel.toString()+t.key+t.value;this.setBodyLayout(),this.setBodyLayoutContentByData(this.data[e],item)}this.result=this.defaultValue}}),s.extend(n.prototype,{getBox:function(){return s("#".concat(this.id))},getBoxShade:function(){return s("#".concat(this.id,"_shade"))},getBoxBtnCancel:function(){return this.getBox().find(".cascader-btns .cascaderCancel")},getBoxBtnOK:function(){return this.getBox().find(".cascader-btns .cascaderOK")},getLastItem:function(){return this.getBox().find(".cascader-body").last().find(".cascader-body-content")}}),s.extend(n.prototype,{setLayout:function(){var t=[];t.push('<div id="'.concat(this.id,'" class="cascader-box">')),t.push('<div class="cascader-btns">'),t.push('<button class="c-btn c-btn-default c-btn-mini cascaderCancel">取消</button>'),t.push('<button class="c-btn c-btn-default c-btn-mini c-btn-primary cascaderOK">确认</button>'),t.push("</div>"),t.push("</div>"),t.push('<div id="'.concat(this.id,'_shade" class="cascader-box-shade"></div>')),s("body").append(t.join(""))},setBodyLayout:function(){var t=0<arguments.length&&arguments[0]!==c?arguments[0]:{key:"",value:""},e=[],a=this.option.crtLevel,i=this.isHasSearchLevel()?this.getBodyLayoutHeader():"",n=this.getBodyLayoutContent();e.push('<div class="cascader-body" data-level="'.concat(a,'" data-key="').concat(t.key,'" data-value="').concat(t.value,'">')),e.push(i),e.push(n),e.push("</div>"),this.clearBodyLayoutByLevel(a),this.getBox().append(e.join(""))},clearBodyLayoutByLevel:function(e){this.getBox().find(".cascader-body").each(function(t){e<=t&&s(this).remove()})},getBodyLayoutHeader:function(){var t=[];return t.push('<div class="cascader-body-header">'),t.push('<input type="text"/>'),t.push("</div>"),t.join("")},getBodyLayoutContent:function(){var t=[],e="cascader-body-content"+(this.isHasSearchLevel()?" v2":"");return t.push('<ul class="'.concat(e,'">')),t.push('<li class="cascader-item-loading"><span>加载中...</span></li>'),t.push("</ul>"),t.join("")},setBodyLayoutContentByData:function(t){var e=1<arguments.length&&arguments[1]!==c?arguments[1]:{key:"",value:""},a=[],i=this.option.crtLevel===this.option.maxLevel?"":" more-icon";t.forEach(function(t){a.push('<li class="cascader-item'.concat(i).concat(t.key===e.key?" active":"",'" data-key="').concat(t.key,'" data-value="').concat(t.value,'"><span>').concat(t.value,"</span></li>"))}),this.getLastItem().html(a.join(""))},isHasSearchLevel:function(){return-1<this.option.hasSearchLevel.indexOf(this.option.crtLevel)}}),s.extend(n.prototype,{getData:function(t){var e=!(1<arguments.length&&arguments[1]!==c)||arguments[1];this.option.crtLevel=t,this.unBindEvent(),e?this.setBodyLayout():this.clearBodyLayoutByLevel(t+1);var a=this.getParamsByIndex(t-1),i=this.getDataKey(),n=this.data[i];n?this.getDataCallback(n):this.option.getData.call(this,a,this.getDataCallback.bind(this))},getDataCallback:function(t){var e=this.getDataKey();this.data[e]=t,this.setBodyLayoutContentByData(t),this.bindEvent()},getParamsByIndex:function(t){var e=this.getBox().find(".cascader-body").eq(t);return{key:e.data("key")||"",value:e.data("value")||"",content:s.trim(e.next().find(".cascader-body-header input").val()||"")}},getDataKey:function(){var t=this.getParamsByIndex(this.option.crtLevel-1);return this.option.crtLevel.toString()+t.key+t.value+t.content},getResult:function(){var e=[],a=[],i=[];return this.result.forEach(function(t){e.push(t.key),a.push(t.value),i.push(t)}),{keys:e,values:a,data:i}},getKeyByParentPrev:function(t){var e=t.prev(".cascader-body");return e.length<=0?"0":(parseInt(e.data("level"))+1).toString()+e.data("key")+e.data("value")},setResult:function(t,e){this.result[t]=e,this.result.length=t+1}}),s.extend(n.prototype,{unBindEvent:function(){this.getBox().off("click")},bindEvent:function(){var n=this,t=null;this.getBox().off("click").on("click",".cascader-item",function(){var t=s(this).closest(".cascader-body"),e=1*t.data("level");t.data("key",s(this).data("key")),t.data("value",s(this).data("value"));var a=n.getKeyByParentPrev(t);if(n.setResult(e,n.data[a][s(this).index()]),s(this).addClass("active").siblings().removeClass("active"),n.option.maxLevel===e){var i=n.getResult();n.option.success.call(n,i.keys,i.values,i.data),n.hide()}else n.getData(e+1)}),this.getBox().off("keyup").on("keyup","input",function(){var e=this;clearTimeout(t),t=setTimeout(function(){var t=1*s(e).closest(".cascader-body").data("level");n.getData(t,!1)},300)}),s(this.ele).unbind("click").bind("click",function(){n.show()}),this.getBoxShade().unbind("click").bind("click",function(){n.hide()}),this.getBoxBtnCancel().unbind("click").bind("click",function(){n.hide()}),this.getBoxBtnOK().unbind("click").bind("click",function(){var t=n.getResult();n.option.success.call(n,t.keys,t.values,t.data),n.hide()})}}),n.prototype.show=function(){var t=o.getMaxZIndex(),e=this.ele.offsetLeft,a=this.ele.offsetTop+this.ele.offsetHeight+5;this.getBox().css({display:"block",zIndex:t+100,left:e,top:a}),this.getBoxShade().css({display:"block",zIndex:t+99}),this.scrollFixedPosition()},n.prototype.hide=function(){this.getBox().hide(),this.getBoxShade().hide()},n.prototype.scrollFixedPosition=function(){var t=this;this.option.isScroll||(this.option.isScroll=!0,this.getBox().find(".cascader-item.active").each(function(){t.scrollFixedPositionByElement(this)}))},n.prototype.scrollFixedPositionByElement=function(t){var e=1<arguments.length&&arguments[1]!==c&&arguments[1],a=s(t),i=a.index(),n=a[0].scrollHeight,o=n*i-3*n;a.parent().animate({scrollTop:o},e?300:0)};var o={getMaxZIndex:function(){return Math.max.apply(null,s.map(s("body *"),function(t,e){return"static"!=s(t).css("position")?parseInt(s(t).css("z-index"))||1:-1}))},getRandom:function(){return Math.random().toString().slice(2,12)},getFormatData:function(t){var e={};return this.formatData(t,e,0,parent),e},formatData:function(t,e,a,i){0<t.length&&(e[a.toString()+(i.key||"")+(i.value||"")]=t).forEach(function(t){t.children&&o.formatData(t.children,e,a+1,t)})}}}(window,jQuery);